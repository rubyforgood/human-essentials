<%= simple_form_for @item, remote: request.xhr?, html: {class: 'form-horizontal'} do |f| %>
  <section class="content">
    <div class="container-fluid">
      <div class="row">
        <!-- left column -->
        <div class="col-md-12">
          <!-- jquery validation -->
          <div class="card card-primary">
            <!-- /.card-header -->
            <!-- form start -->
            <div class="card-body">
              <%= f.input :name, label: "Name", wrapper: :input_group do %>
                <span class="input-group-text"><i class="fa fa-tag"></i></span>
                <%= f.input_field :name, class: "form-control" %>
              <% end %>

              <div class='w-1/4'>
                <%= f.input :item_category_id, label: 'Category', collection: @item_categories, hint: 'Categories can help organize and identify items' %>
              </div>
              <div class='w-1/4'>

                <%= f.input :reporting_category, label: 'NDBN Reporting Category', collection: Item.reporting_categories_for_select, disabled: !!@item.kit_id, required: !@item.kit_id, hint: @reporting_category_hint %>
              </div>

              <%= f.input :name, label: "Value per item", wrapper: :input_group do %>
                <span class="input-group-text"><i class="fa fa-money"></i></span>
                <%= f.input_field :value_in_dollars, class: "form-control" %>
              <% end %>

              <%= f.input :name, label: "Quantity Per Individual", wrapper: :input_group do %>
                <%= f.input_field :distribution_quantity, class: "form-control" %>
              <% end %>

              <% if current_user.has_cached_role?(Role::ORG_ADMIN, current_organization) %>
                <%= f.input :name, label: "On hand minimum quantity", wrapper: :input_group do %>
                  <%= f.input_field :on_hand_minimum_quantity, input_html: {value: 0}, class: "form-control" %>
                <% end %>
                <%= f.input :name, label: "On hand recommended quantity", wrapper: :input_group do %>
                  <%= f.input_field :on_hand_recommended_quantity, class: "form-control" %>
                <% end %>
              <% end %>

              <%= f.input :name, label: "Package size", wrapper: :input_group do %>
                <%= f.input_field :package_size, class: "form-control", min: 0 %>
              <% end %>

              <%= f.input :name, label: "Request limit (individual items)", wrapper: :input_group do %>
                <%= f.input_field :unit_request_limit, class: "form-control", min: 0 %>
              <% end %>

              <% if Flipper.enabled?(:enable_packs) %>
                <%= f.input :request_units, label: "Additional Custom Request Units" do %>
                  <% current_organization.request_units.each do |unit| %>
                    <% item_unit = @item.request_units.find { |item_unit| item_unit.name == unit.name } %>
                    <% selected = item_unit.present? %>

                    <div class="form-check mb-2">
                      <%= check_box_tag "item[unit_ids][]", unit.id, selected, id: "unit_#{unit.id}", class: "form-check-input" %>
                      <%= label_tag "unit_#{unit.id}", unit.name, class: "form-check-label me-2" %>

                      <%= number_field_tag "item[unit_limits][#{unit.id}]",
                                           item_unit&.request_limit,
                                           class: "form-control d-inline-block w-auto",
                                           min: 0,
                                           placeholder: "Limit",
                                           disabled: !selected %>
                    </div>
                  <% end %>

                  <!-- keep the param key present even if nothing checked -->
                  <%= hidden_field_tag "item[unit_ids][]", "" %>
                <% end %>

                <script>
                    // Optional: toggle limit input enabled state with the checkbox
                    document.addEventListener("change", (e) => {
                        if (e.target.matches('input[type="checkbox"][id^="unit_"]')) {
                            const id = e.target.id.replace("unit_", "");
                            const limit = document.querySelector(`input[name="item[unit_limits][${id}]"]`);
                            if (limit) limit.disabled = !e.target.checked;
                        }
                    });
                </script>
              <% end %>

              <%= f.input :visible, label: "Item is Visible to Partners?", wrapper: :input_group do %>
                <%= f.check_box :visible_to_partners, {class: "input-group-text", id: "visible_to_partners"}, "true", "false" %>
              <% end %>

              <%= f.label :additional_info, "Additional Information (Bank Use Only) " %> <i>(500 character max)</i>
              <%= f.input :additional_info, label: false, maxlength: 500, wrapper: :input_group %>
            </div>
            <!-- /.card-body -->
            <div class="card-footer">
              <%= submit_button %>
            </div>
          </div>
          <!-- /.card -->
        </div>
        <!--/.col (left) -->
        <!-- right column -->
        <div class="col-md-6">

        </div>
        <!--/.col (right) -->
      </div>
      <!-- /.row -->
    </div><!-- /.container-fluid -->
  </section>
<% end %>
