<section class="content-header">
  <% content_for :title, "Admin Dashboard" %>
  <h1>
    Admin Dashboard
  </h1>
  <ol class="breadcrumb">
    <li><a href="#"><i class="fa fa-dashboard"></i> Admin</a></li>
    <li><a href="#">Dashboard</a></li>
  </ol>
</section>

<section class="content">
  <div class="row">
    <div class="col-md-3 col-sm-6 col-xs-12">
      <div class="info-box">
        <span class="info-box-icon bg-aqua"><i class="fa fa-gratipay"></i></span>

        <div class="info-box-content">
          <span class="info-box-text">Donations</span>
          <span class="info-box-number"><%= @donation_count %></span>
        </div><!-- /.info-box-content -->
      </div><!-- /.info-box -->
    </div><!-- /.col -->
    <div class="col-md-3 col-sm-6 col-xs-12">
      <div class="info-box">
        <span class="info-box-icon bg-red"><i class="fa fa-money"></i></span>

        <div class="info-box-content">
          <span class="info-box-text">Distributions</span>
          <span class="info-box-number"><%= @distribution_count %></span>
        </div><!-- /.info-box-content -->
      </div><!-- /.info-box -->
    </div><!-- /.col -->

    <!-- fix for small devices only -->
    <div class="clearfix visible-sm-block"></div>

    <div class="col-md-3 col-sm-6 col-xs-12">
      <div class="info-box">
        <span class="info-box-icon bg-green"><i class="fa fa-file-text"></i></span>

        <div class="info-box-content">
          <span class="info-box-text">Requests</span>
          <span class="info-box-number"><%= @request_count %></span>
        </div><!-- /.info-box-content -->
      </div><!-- /.info-box -->
    </div><!-- /.col -->
    <div class="col-md-3 col-sm-6 col-xs-12">
      <div class="info-box">
        <span class="info-box-icon bg-yellow"><i class="ion ion-ios-people-outline"></i></span>

        <div class="info-box-content">
          <span class="info-box-text">Total Organizations</span>
          <span class="info-box-number"><%= @organization_count %></span>
        </div><!-- /.info-box-content -->
      </div><!-- /.info-box -->
    </div><!-- /.col -->
  </div>

  <div class="row">
    <div class="col-md-6">
      <!-- USERS LIST -->
      <div class="box box-success">
        <div class="box-header with-border">
          <h3 class="box-title">Recently Added Users</h3>

          <div class="box-tools pull-right">
            <span class="label label-danger"><%= pluralize(@recent_users.count, "New User") %></span>
            <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
            </button>
            <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i>
            </button>
          </div>
        </div>
        <!-- /.box-header -->
        <div class="box-body no-padding">
          <ul class="users-list clearfix">
            <% @recent_users.each do |user| %>
            <li>
              <%= image_tag gravatar_url(user.email, 32) %>
              <%= link_to user.name, admin_user_path(user), class: "users-list-name" %>
              <span class="users-list-date"><%= time_ago_in_words(user.created_at) %></span>
            </li>
            <% end %>
          </ul>
          <!-- /.users-list -->
        </div>
        <!-- /.box-body -->
        <div class="box-footer text-center">
          <%= link_to "View All Users", admin_users_path %>
        </div>
        <!-- /.box-footer -->
      </div>
      <!--/.box -->
    </div>
    <div class="col-md-6">
      <!-- USERS LIST -->
      <div class="box box-info">
        <div class="box-header with-border">
          <h3 class="box-title">Recently Added Organizations</h3>

          <div class="box-tools pull-right">
            <span class="label label-danger"><%= pluralize(@recent_organizations.count, "New Organization") %></span>
            <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
            </button>
            <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i>
            </button>
          </div>
        </div>
        <!-- /.box-header -->
        <div class="box-body no-padding">
          <ul class="users-list clearfix">
            <% @recent_organizations.each do |org| %>
            <li>
              <%#= image_tag(org&.logo)
              %>
              <%= link_to org.name, admin_organization_path(org), class: "users-list-name" %>
              <span class="users-list-date"><%= time_ago_in_words(org.created_at) %></span>
            </li>
            <% end %>
          </ul>
          <!-- /.users-list -->
        </div>
        <!-- /.box-body -->
        <div class="box-footer text-center">
          <%= link_to "View All Organizations", admin_organizations_path %>
        </div>
        <!-- /.box-footer -->
      </div>
      <!--/.box -->
    </div>
  </div>
  <div class="col-md-14">
    <div class="box box-info">
      <div class="box-header with-border">
        <h3 class="box-title">Top 10 Uses of Other</h3>

        <div class="box-tools pull-right">
          <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
          </button>
          <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
        </div>
      </div>
      <!-- /.box-header -->
      <div class="box-body">
        <div class="table-responsive">
          <table class="table no-margin">
            <thead>
            <tr>
              <th>Name</th>
              <th>Occurrence</th>
            </tr>
            </thead>
            <tbody>
            <% @top_10_other.each do |other| %>
            <tr>
              <td><%= other[0] %></td>
              <td><%= other[1] %></td>
            </tr>
            <% end %>
            </tbody>
          </table>
        </div>
        <!-- /.table-responsive -->
      </div>
      <!-- /.box-body -->
      <div class="box-footer clearfix">
        <%= link_to "View All Items", admin_base_items_path %>
      </div>
      <!-- /.box-footer -->
    </div>
  </div>
  <div class="col-md-14">
    <div class="box box-warning">
      <div class="box-header with-border">
        <h3 class="box-title">Users Active Within Past Week</h3>

        <div class="box-tools pull-right">
          <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
          </button>
          <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
        </div>
      </div>
      <!-- /.box-header -->
      <div class="box-body">
        <div class="table-responsive">
          <table class="table no-margin">
            <thead>
            <tr>
              <th>User</th>
              <th>Email</th>
              <th>Organization</th>
              <th>Last Active</th>
            </tr>
            </thead>
            <tbody>
            <% @active_users.each do |user| %>
              <tr>
                <td><%= user.name %></td>
                <td><%= user.email %></td>
                <td><%= user.organization&.name %></td>
                <td><%= time_ago_in_words user.last_request_at %></td>
              </tr>
            <% end %>
            </tbody>
          </table>
        </div>
        <!-- /.table-responsive -->
      </div>
      <!-- /.box-footer -->
    </div>
  </div>
</section>
