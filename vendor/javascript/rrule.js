// rrule@2.8.1 downloaded from https://ga.jspm.io/npm:rrule@2.8.1/dist/esm/index.js

import{__extends as e,__assign as t,__spreadArray as r}from"tslib";import n from"./nlp/i18n.js";var a=["MO","TU","WE","TH","FR","SA","SU"];var i=function(){function Weekday(e,t){if(t===0)throw new Error("Can't create weekday with n == 0");this.weekday=e;this.n=t}Weekday.fromStr=function(e){return new Weekday(a.indexOf(e))};Weekday.prototype.nth=function(e){return this.n===e?this:new Weekday(this.weekday,e)};Weekday.prototype.equals=function(e){return this.weekday===e.weekday&&this.n===e.n};Weekday.prototype.toString=function(){var e=a[this.weekday];this.n&&(e=(this.n>0?"+":"")+String(this.n)+e);return e};Weekday.prototype.getJsWeekday=function(){return this.weekday===6?0:this.weekday+1};return Weekday}();var isPresent=function(e){return e!==null&&e!==void 0};var isNumber=function(e){return typeof e==="number"};var isWeekdayStr=function(e){return typeof e==="string"&&a.includes(e)};var o=Array.isArray;var range=function(e,t){t===void 0&&(t=e);if(arguments.length===1){t=e;e=0}var r=[];for(var n=e;n<t;n++)r.push(n);return r};var repeat=function(e,t){var r=0;var n=[];if(o(e))for(;r<t;r++)n[r]=[].concat(e);else for(;r<t;r++)n[r]=e;return n};var toArray=function(e){return o(e)?e:[e]};function padStart(e,t,r){r===void 0&&(r=" ");var n=String(e);t>>=0;if(n.length>t)return String(n);t-=n.length;t>r.length&&(r+=repeat(r,t/r.length));return r.slice(0,t)+String(n)}var split=function(e,t,r){var n=e.split(t);return r?n.slice(0,r).concat([n.slice(r).join(t)]):n};
/**
 * closure/goog/math/math.js:modulo
 * Copyright 2006 The Closure Library Authors.
 * The % operator in JavaScript returns the remainder of a / b, but differs from
 * some other languages in that the result will have the same sign as the
 * dividend. For example, -1 % 8 == -1, whereas in some other languages
 * (such as Python) the result would be 7. This function emulates the more
 * correct modulo behavior, which is useful for certain applications such as
 * calculating an offset index in a circular list.
 *
 * @param {number} a The dividend.
 * @param {number} b The divisor.
 * @return {number} a % b where the result is between 0 and b (either 0 <= x < b
 * or b < x <= 0, depending on the sign of b).
 */var pymod=function(e,t){var r=e%t;return r*t<0?r+t:r};var divmod=function(e,t){return{div:Math.floor(e/t),mod:pymod(e,t)}};var empty=function(e){return!isPresent(e)||e.length===0};var notEmpty=function(e){return!empty(e)};var includes=function(e,t){return notEmpty(e)&&e.indexOf(t)!==-1};var datetime=function(e,t,r,n,a,i){n===void 0&&(n=0);a===void 0&&(a=0);i===void 0&&(i=0);return new Date(Date.UTC(e,t-1,r,n,a,i))};var s=[31,28,31,30,31,30,31,31,30,31,30,31];var u=864e5;var h=9999;var l=datetime(1970,1,1);var d=[6,0,1,2,3,4,5];var isLeapYear=function(e){return e%4===0&&e%100!==0||e%400===0};var isDate=function(e){return e instanceof Date};var isValidDate=function(e){return isDate(e)&&!isNaN(e.getTime())};var daysBetween=function(e,t){var r=e.getTime();var n=t.getTime();var a=r-n;return Math.round(a/u)};var toOrdinal=function(e){return daysBetween(e,l)};var fromOrdinal=function(e){return new Date(l.getTime()+e*u)};var getMonthDays=function(e){var t=e.getUTCMonth();return t===1&&isLeapYear(e.getUTCFullYear())?29:s[t]};var getWeekday=function(e){return d[e.getUTCDay()]};var monthRange=function(e,t){var r=datetime(e,t+1,1);return[getWeekday(r),getMonthDays(r)]};var combine=function(e,t){t=t||e;return new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()))};var clone=function(e){var t=new Date(e.getTime());return t};var cloneDates=function(e){var t=[];for(var r=0;r<e.length;r++)t.push(clone(e[r]));return t};var sort=function(e){e.sort((function(e,t){return e.getTime()-t.getTime()}))};var timeToUntilString=function(e,t){t===void 0&&(t=true);var r=new Date(e);return[padStart(r.getUTCFullYear().toString(),4,"0"),padStart(r.getUTCMonth()+1,2,"0"),padStart(r.getUTCDate(),2,"0"),"T",padStart(r.getUTCHours(),2,"0"),padStart(r.getUTCMinutes(),2,"0"),padStart(r.getUTCSeconds(),2,"0"),t?"Z":""].join("")};var untilStringToDate=function(e){var t=/^(\d{4})(\d{2})(\d{2})(T(\d{2})(\d{2})(\d{2})Z?)?$/;var r=t.exec(e);if(!r)throw new Error("Invalid UNTIL value: ".concat(e));return new Date(Date.UTC(parseInt(r[1],10),parseInt(r[2],10)-1,parseInt(r[3],10),parseInt(r[5],10)||0,parseInt(r[6],10)||0,parseInt(r[7],10)||0))};var dateTZtoISO8601=function(e,t){var r=e.toLocaleString("sv-SE",{timeZone:t});return r.replace(" ","T")+"Z"};var dateInTimeZone=function(e,t){var r=Intl.DateTimeFormat().resolvedOptions().timeZone;var n=new Date(dateTZtoISO8601(e,r));var a=new Date(dateTZtoISO8601(e,t!==null&&t!==void 0?t:"UTC"));var i=a.getTime()-n.getTime();return new Date(e.getTime()-i)};var c=function(){function IterResult(e,t){this.minDate=null;this.maxDate=null;this._result=[];this.total=0;this.method=e;this.args=t;if(e==="between"){this.maxDate=t.inc?t.before:new Date(t.before.getTime()-1);this.minDate=t.inc?t.after:new Date(t.after.getTime()+1)}else e==="before"?this.maxDate=t.inc?t.dt:new Date(t.dt.getTime()-1):e==="after"&&(this.minDate=t.inc?t.dt:new Date(t.dt.getTime()+1))}
/**
     * Possibly adds a date into the result.
     *
     * @param {Date} date - the date isn't necessarly added to the result
     * list (if it is too late/too early)
     * @return {Boolean} true if it makes sense to continue the iteration
     * false if we're done.
     */IterResult.prototype.accept=function(e){++this.total;var t=this.minDate&&e<this.minDate;var r=this.maxDate&&e>this.maxDate;if(this.method==="between"){if(t)return true;if(r)return false}else if(this.method==="before"){if(r)return false}else if(this.method==="after"){if(t)return true;this.add(e);return false}return this.add(e)};
/**
     *
     * @param {Date} date that is part of the result.
     * @return {Boolean} whether we are interested in more values.
     */IterResult.prototype.add=function(e){this._result.push(e);return true};IterResult.prototype.getValue=function(){var e=this._result;switch(this.method){case"all":case"between":return e;case"before":case"after":default:return e.length?e[e.length-1]:null}};IterResult.prototype.clone=function(){return new IterResult(this.method,this.args)};return IterResult}();var y=function(t){e(CallbackIterResult,t);function CallbackIterResult(e,r,n){var a=t.call(this,e,r)||this;a.iterator=n;return a}CallbackIterResult.prototype.add=function(e){if(this.iterator(e,this._result.length)){this._result.push(e);return true}return false};return CallbackIterResult}(c);var contains=function(e,t){return e.indexOf(t)!==-1};var defaultGetText=function(e){return e.toString()};var defaultDateFormatter=function(e,t,r){return"".concat(t," ").concat(r,", ").concat(e)};
/**
 *
 * @param {RRule} rrule
 * Optional:
 * @param {Function} gettext function
 * @param {Object} language definition
 * @constructor
 */var f=function(){function ToText(e,t,r,a){t===void 0&&(t=defaultGetText);r===void 0&&(r=n);a===void 0&&(a=defaultDateFormatter);this.text=[];this.language=r||n;this.gettext=t;this.dateFormatter=a;this.rrule=e;this.options=e.options;this.origOptions=e.origOptions;if(this.origOptions.bymonthday){var i=[].concat(this.options.bymonthday);var s=[].concat(this.options.bynmonthday);i.sort((function(e,t){return e-t}));s.sort((function(e,t){return t-e}));this.bymonthday=i.concat(s);this.bymonthday.length||(this.bymonthday=null)}if(isPresent(this.origOptions.byweekday)){var u=o(this.origOptions.byweekday)?this.origOptions.byweekday:[this.origOptions.byweekday];var h=String(u);this.byweekday={allWeeks:u.filter((function(e){return!e.n})),someWeeks:u.filter((function(e){return Boolean(e.n)})),isWeekdays:h.indexOf("MO")!==-1&&h.indexOf("TU")!==-1&&h.indexOf("WE")!==-1&&h.indexOf("TH")!==-1&&h.indexOf("FR")!==-1&&h.indexOf("SA")===-1&&h.indexOf("SU")===-1,isEveryDay:h.indexOf("MO")!==-1&&h.indexOf("TU")!==-1&&h.indexOf("WE")!==-1&&h.indexOf("TH")!==-1&&h.indexOf("FR")!==-1&&h.indexOf("SA")!==-1&&h.indexOf("SU")!==-1};var sortWeekDays=function(e,t){return e.weekday-t.weekday};this.byweekday.allWeeks.sort(sortWeekDays);this.byweekday.someWeeks.sort(sortWeekDays);this.byweekday.allWeeks.length||(this.byweekday.allWeeks=null);this.byweekday.someWeeks.length||(this.byweekday.someWeeks=null)}else this.byweekday=null}
/**
     * Test whether the rrule can be fully converted to text.
     *
     * @param {RRule} rrule
     * @return {Boolean}
     */ToText.isFullyConvertible=function(e){var t=true;if(!(e.options.freq in ToText.IMPLEMENTED))return false;if(e.origOptions.until&&e.origOptions.count)return false;for(var r in e.origOptions){if(contains(["dtstart","tzid","wkst","freq"],r))return true;if(!contains(ToText.IMPLEMENTED[e.options.freq],r))return false}return t};ToText.prototype.isFullyConvertible=function(){return ToText.isFullyConvertible(this.rrule)};ToText.prototype.toString=function(){var e=this.gettext;if(!(this.options.freq in ToText.IMPLEMENTED))return e("RRule error: Unable to fully convert this rrule to text");this.text=[e("every")];this[Z.FREQUENCIES[this.options.freq]]();if(this.options.until){this.add(e("until"));var t=this.options.until;this.add(this.dateFormatter(t.getUTCFullYear(),this.language.monthNames[t.getUTCMonth()],t.getUTCDate()))}else this.options.count&&this.add(e("for")).add(this.options.count.toString()).add(this.plural(this.options.count)?e("times"):e("time"));this.isFullyConvertible()||this.add(e("(~ approximate)"));return this.text.join("")};ToText.prototype.HOURLY=function(){var e=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString());this.add(this.plural(this.options.interval)?e("hours"):e("hour"))};ToText.prototype.MINUTELY=function(){var e=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString());this.add(this.plural(this.options.interval)?e("minutes"):e("minute"))};ToText.prototype.DAILY=function(){var e=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString());this.byweekday&&this.byweekday.isWeekdays?this.add(this.plural(this.options.interval)?e("weekdays"):e("weekday")):this.add(this.plural(this.options.interval)?e("days"):e("day"));if(this.origOptions.bymonth){this.add(e("in"));this._bymonth()}this.bymonthday?this._bymonthday():this.byweekday?this._byweekday():this.origOptions.byhour&&this._byhour()};ToText.prototype.WEEKLY=function(){var e=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()).add(this.plural(this.options.interval)?e("weeks"):e("week"));if(this.byweekday&&this.byweekday.isWeekdays)this.options.interval===1?this.add(this.plural(this.options.interval)?e("weekdays"):e("weekday")):this.add(e("on")).add(e("weekdays"));else if(this.byweekday&&this.byweekday.isEveryDay)this.add(this.plural(this.options.interval)?e("days"):e("day"));else{this.options.interval===1&&this.add(e("week"));if(this.origOptions.bymonth){this.add(e("in"));this._bymonth()}this.bymonthday?this._bymonthday():this.byweekday&&this._byweekday();this.origOptions.byhour&&this._byhour()}};ToText.prototype.MONTHLY=function(){var e=this.gettext;if(this.origOptions.bymonth){if(this.options.interval!==1){this.add(this.options.interval.toString()).add(e("months"));this.plural(this.options.interval)&&this.add(e("in"))}this._bymonth()}else{this.options.interval!==1&&this.add(this.options.interval.toString());this.add(this.plural(this.options.interval)?e("months"):e("month"))}this.bymonthday?this._bymonthday():this.byweekday&&this.byweekday.isWeekdays?this.add(e("on")).add(e("weekdays")):this.byweekday&&this._byweekday()};ToText.prototype.YEARLY=function(){var e=this.gettext;if(this.origOptions.bymonth){if(this.options.interval!==1){this.add(this.options.interval.toString());this.add(e("years"))}this._bymonth()}else{this.options.interval!==1&&this.add(this.options.interval.toString());this.add(this.plural(this.options.interval)?e("years"):e("year"))}this.bymonthday?this._bymonthday():this.byweekday&&this._byweekday();this.options.byyearday&&this.add(e("on the")).add(this.list(this.options.byyearday,this.nth,e("and"))).add(e("day"));this.options.byweekno&&this.add(e("in")).add(this.plural(this.options.byweekno.length)?e("weeks"):e("week")).add(this.list(this.options.byweekno,void 0,e("and")))};ToText.prototype._bymonthday=function(){var e=this.gettext;this.byweekday&&this.byweekday.allWeeks?this.add(e("on")).add(this.list(this.byweekday.allWeeks,this.weekdaytext,e("or"))).add(e("the")).add(this.list(this.bymonthday,this.nth,e("or"))):this.add(e("on the")).add(this.list(this.bymonthday,this.nth,e("and")))};ToText.prototype._byweekday=function(){var e=this.gettext;this.byweekday.allWeeks&&!this.byweekday.isWeekdays&&this.add(e("on")).add(this.list(this.byweekday.allWeeks,this.weekdaytext));if(this.byweekday.someWeeks){this.byweekday.allWeeks&&this.add(e("and"));this.add(e("on the")).add(this.list(this.byweekday.someWeeks,this.weekdaytext,e("and")))}};ToText.prototype._byhour=function(){var e=this.gettext;this.add(e("at")).add(this.list(this.origOptions.byhour,void 0,e("and")))};ToText.prototype._bymonth=function(){this.add(this.list(this.options.bymonth,this.monthtext,this.gettext("and")))};ToText.prototype.nth=function(e){e=parseInt(e.toString(),10);var t;var r=this.gettext;if(e===-1)return r("last");var n=Math.abs(e);switch(n){case 1:case 21:case 31:t=n+r("st");break;case 2:case 22:t=n+r("nd");break;case 3:case 23:t=n+r("rd");break;default:t=n+r("th")}return e<0?t+" "+r("last"):t};ToText.prototype.monthtext=function(e){return this.language.monthNames[e-1]};ToText.prototype.weekdaytext=function(e){var t=isNumber(e)?(e+1)%7:e.getJsWeekday();return(e.n?this.nth(e.n)+" ":"")+this.language.dayNames[t]};ToText.prototype.plural=function(e){return e%100!==1};ToText.prototype.add=function(e){this.text.push(" ");this.text.push(e);return this};ToText.prototype.list=function(e,t,r,n){var a=this;n===void 0&&(n=",");o(e)||(e=[e]);var delimJoin=function(e,t,r){var n="";for(var a=0;a<e.length;a++){a!==0&&(a===e.length-1?n+=" "+r+" ":n+=t+" ");n+=e[a]}return n};t=t||function(e){return e.toString()};var realCallback=function(e){return t&&t.call(a,e)};return r?delimJoin(e.map(realCallback),n,r):e.map(realCallback).join(n+" ")};return ToText}();var p=function(){function Parser(e){this.done=true;this.rules=e}Parser.prototype.start=function(e){this.text=e;this.done=false;return this.nextSymbol()};Parser.prototype.isDone=function(){return this.done&&this.symbol===null};Parser.prototype.nextSymbol=function(){var e;var t;this.symbol=null;this.value=null;do{if(this.done)return false;var r=void 0;e=null;for(var n in this.rules){r=this.rules[n];var a=r.exec(this.text);if(a&&(e===null||a[0].length>e[0].length)){e=a;t=n}}if(e!=null){this.text=this.text.substr(e[0].length);this.text===""&&(this.done=true)}if(e==null){this.done=true;this.symbol=null;this.value=null;return}}while(t==="SKIP");this.symbol=t;this.value=e;return true};Parser.prototype.accept=function(e){if(this.symbol===e){if(this.value){var t=this.value;this.nextSymbol();return t}this.nextSymbol();return true}return false};Parser.prototype.acceptNumber=function(){return this.accept("number")};Parser.prototype.expect=function(e){if(this.accept(e))return true;throw new Error("expected "+e+" but found "+this.symbol)};return Parser}();function parseText(e,t){t===void 0&&(t=n);var r={};var a=new p(t.tokens);if(!a.start(e))return null;S();return r;function S(){a.expect("every");var e=a.acceptNumber();e&&(r.interval=parseInt(e[0],10));if(a.isDone())throw new Error("Unexpected end");switch(a.symbol){case"day(s)":r.freq=Z.DAILY;if(a.nextSymbol()){AT();F()}break;case"weekday(s)":r.freq=Z.WEEKLY;r.byweekday=[Z.MO,Z.TU,Z.WE,Z.TH,Z.FR];a.nextSymbol();AT();F();break;case"week(s)":r.freq=Z.WEEKLY;if(a.nextSymbol()){ON();AT();F()}break;case"hour(s)":r.freq=Z.HOURLY;if(a.nextSymbol()){ON();F()}break;case"minute(s)":r.freq=Z.MINUTELY;if(a.nextSymbol()){ON();F()}break;case"month(s)":r.freq=Z.MONTHLY;if(a.nextSymbol()){ON();F()}break;case"year(s)":r.freq=Z.YEARLY;if(a.nextSymbol()){ON();F()}break;case"monday":case"tuesday":case"wednesday":case"thursday":case"friday":case"saturday":case"sunday":r.freq=Z.WEEKLY;var t=a.symbol.substr(0,2).toUpperCase();r.byweekday=[Z[t]];if(!a.nextSymbol())return;while(a.accept("comma")){if(a.isDone())throw new Error("Unexpected end");var n=decodeWKD();if(!n)throw new Error("Unexpected symbol "+a.symbol+", expected weekday");r.byweekday.push(Z[n]);a.nextSymbol()}AT();MDAYs();F();break;case"january":case"february":case"march":case"april":case"may":case"june":case"july":case"august":case"september":case"october":case"november":case"december":r.freq=Z.YEARLY;r.bymonth=[decodeM()];if(!a.nextSymbol())return;while(a.accept("comma")){if(a.isDone())throw new Error("Unexpected end");var i=decodeM();if(!i)throw new Error("Unexpected symbol "+a.symbol+", expected month");r.bymonth.push(i);a.nextSymbol()}ON();F();break;default:throw new Error("Unknown symbol")}}function ON(){var e=a.accept("on");var t=a.accept("the");if(e||t)do{var n=decodeNTH();var i=decodeWKD();var o=decodeM();if(n)if(i){a.nextSymbol();r.byweekday||(r.byweekday=[]);r.byweekday.push(Z[i].nth(n))}else{r.bymonthday||(r.bymonthday=[]);r.bymonthday.push(n);a.accept("day(s)")}else if(i){a.nextSymbol();r.byweekday||(r.byweekday=[]);r.byweekday.push(Z[i])}else if(a.symbol==="weekday(s)"){a.nextSymbol();r.byweekday||(r.byweekday=[Z.MO,Z.TU,Z.WE,Z.TH,Z.FR])}else if(a.symbol==="week(s)"){a.nextSymbol();var s=a.acceptNumber();if(!s)throw new Error("Unexpected symbol "+a.symbol+", expected week number");r.byweekno=[parseInt(s[0],10)];while(a.accept("comma")){s=a.acceptNumber();if(!s)throw new Error("Unexpected symbol "+a.symbol+"; expected monthday");r.byweekno.push(parseInt(s[0],10))}}else{if(!o)return;a.nextSymbol();r.bymonth||(r.bymonth=[]);r.bymonth.push(o)}}while(a.accept("comma")||a.accept("the")||a.accept("on"))}function AT(){var e=a.accept("at");if(e)do{var t=a.acceptNumber();if(!t)throw new Error("Unexpected symbol "+a.symbol+", expected hour");r.byhour=[parseInt(t[0],10)];while(a.accept("comma")){t=a.acceptNumber();if(!t)throw new Error("Unexpected symbol "+a.symbol+"; expected hour");r.byhour.push(parseInt(t[0],10))}}while(a.accept("comma")||a.accept("at"))}function decodeM(){switch(a.symbol){case"january":return 1;case"february":return 2;case"march":return 3;case"april":return 4;case"may":return 5;case"june":return 6;case"july":return 7;case"august":return 8;case"september":return 9;case"october":return 10;case"november":return 11;case"december":return 12;default:return false}}function decodeWKD(){switch(a.symbol){case"monday":case"tuesday":case"wednesday":case"thursday":case"friday":case"saturday":case"sunday":return a.symbol.substr(0,2).toUpperCase();default:return false}}function decodeNTH(){switch(a.symbol){case"last":a.nextSymbol();return-1;case"first":a.nextSymbol();return 1;case"second":a.nextSymbol();return a.accept("last")?-2:2;case"third":a.nextSymbol();return a.accept("last")?-3:3;case"nth":var e=parseInt(a.value[1],10);if(e<-366||e>366)throw new Error("Nth out of range: "+e);a.nextSymbol();return a.accept("last")?-e:e;default:return false}}function MDAYs(){a.accept("on");a.accept("the");var e=decodeNTH();if(e){r.bymonthday=[e];a.nextSymbol();while(a.accept("comma")){e=decodeNTH();if(!e)throw new Error("Unexpected symbol "+a.symbol+"; expected monthday");r.bymonthday.push(e);a.nextSymbol()}}}function F(){if(a.symbol==="until"){var e=Date.parse(a.text);if(!e)throw new Error("Cannot parse until date:"+a.text);r.until=new Date(e)}else if(a.accept("for")){r.count=parseInt(a.value[0],10);a.expect("number")}}}var m;(function(e){e[e.YEARLY=0]="YEARLY";e[e.MONTHLY=1]="MONTHLY";e[e.WEEKLY=2]="WEEKLY";e[e.DAILY=3]="DAILY";e[e.HOURLY=4]="HOURLY";e[e.MINUTELY=5]="MINUTELY";e[e.SECONDLY=6]="SECONDLY"})(m||(m={}));function freqIsDailyOrGreater(e){return e<m.HOURLY}
/**
 * Will be able to convert some of the below described rules from
 * text format to a rule object.
 *
 *
 * RULES
 *
 * Every ([n])
 * day(s)
 * | [weekday], ..., (and) [weekday]
 * | weekday(s)
 * | week(s)
 * | month(s)
 * | [month], ..., (and) [month]
 * | year(s)
 *
 *
 * Plus 0, 1, or multiple of these:
 *
 * on [weekday], ..., (or) [weekday] the [monthday], [monthday], ... (or) [monthday]
 *
 * on [weekday], ..., (and) [weekday]
 *
 * on the [monthday], [monthday], ... (and) [monthday] (day of the month)
 *
 * on the [nth-weekday], ..., (and) [nth-weekday] (of the month/year)
 *
 *
 * Plus 0 or 1 of these:
 *
 * for [n] time(s)
 *
 * until [date]
 *
 * Plus (.)
 *
 *
 * Definitely no supported for parsing:
 *
 * (for year):
 * in week(s) [n], ..., (and) [n]
 *
 * on the [yearday], ..., (and) [n] day of the year
 * on day [yearday], ..., (and) [n]
 *
 *
 * NON-TERMINALS
 *
 * [n]: 1, 2 ..., one, two, three ..
 * [month]: January, February, March, April, May, ... December
 * [weekday]: Monday, ... Sunday
 * [nth-weekday]: first [weekday], 2nd [weekday], ... last [weekday], ...
 * [monthday]: first, 1., 2., 1st, 2nd, second, ... 31st, last day, 2nd last day, ..
 * [date]:
 * - [month] (0-31(,) ([year])),
 * - (the) 0-31.(1-12.([year])),
 * - (the) 0-31/(1-12/([year])),
 * - [weekday]
 *
 * [year]: 0000, 0001, ... 01, 02, ..
 *
 * Definitely not supported for parsing:
 *
 * [yearday]: first, 1., 2., 1st, 2nd, second, ... 366th, last day, 2nd last day, ..
 *
 * @param {String} text
 * @return {Object, Boolean} the rule, or null.
 */var fromText=function(e,t){t===void 0&&(t=n);return new Z(parseText(e,t)||void 0)};var v=["count","until","interval","byweekday","bymonthday","bymonth"];f.IMPLEMENTED=[];f.IMPLEMENTED[m.HOURLY]=v;f.IMPLEMENTED[m.MINUTELY]=v;f.IMPLEMENTED[m.DAILY]=["byhour"].concat(v);f.IMPLEMENTED[m.WEEKLY]=v;f.IMPLEMENTED[m.MONTHLY]=v;f.IMPLEMENTED[m.YEARLY]=["byweekno","byyearday"].concat(v);var toText=function(e,t,r,n){return new f(e,t,r,n).toString()};var b=f.isFullyConvertible;var w=function(){function Time(e,t,r,n){this.hour=e;this.minute=t;this.second=r;this.millisecond=n||0}Time.prototype.getHours=function(){return this.hour};Time.prototype.getMinutes=function(){return this.minute};Time.prototype.getSeconds=function(){return this.second};Time.prototype.getMilliseconds=function(){return this.millisecond};Time.prototype.getTime=function(){return(this.hour*60*60+this.minute*60+this.second)*1e3+this.millisecond};return Time}();var k=function(t){e(DateTime,t);function DateTime(e,r,n,a,i,o,s){var u=t.call(this,a,i,o,s)||this;u.year=e;u.month=r;u.day=n;return u}DateTime.fromDate=function(e){return new this(e.getUTCFullYear(),e.getUTCMonth()+1,e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.valueOf()%1e3)};DateTime.prototype.getWeekday=function(){return getWeekday(new Date(this.getTime()))};DateTime.prototype.getTime=function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond)).getTime()};DateTime.prototype.getDay=function(){return this.day};DateTime.prototype.getMonth=function(){return this.month};DateTime.prototype.getYear=function(){return this.year};DateTime.prototype.addYears=function(e){this.year+=e};DateTime.prototype.addMonths=function(e){this.month+=e;if(this.month>12){var t=Math.floor(this.month/12);var r=pymod(this.month,12);this.month=r;this.year+=t;if(this.month===0){this.month=12;--this.year}}};DateTime.prototype.addWeekly=function(e,t){t>this.getWeekday()?this.day+=-(this.getWeekday()+1+(6-t))+e*7:this.day+=-(this.getWeekday()-t)+e*7;this.fixDay()};DateTime.prototype.addDaily=function(e){this.day+=e;this.fixDay()};DateTime.prototype.addHours=function(e,t,r){t&&(this.hour+=Math.floor((23-this.hour)/e)*e);for(;;){this.hour+=e;var n=divmod(this.hour,24),a=n.div,i=n.mod;if(a){this.hour=i;this.addDaily(a)}if(empty(r)||includes(r,this.hour))break}};DateTime.prototype.addMinutes=function(e,t,r,n){t&&(this.minute+=Math.floor((1439-(this.hour*60+this.minute))/e)*e);for(;;){this.minute+=e;var a=divmod(this.minute,60),i=a.div,o=a.mod;if(i){this.minute=o;this.addHours(i,false,r)}if((empty(r)||includes(r,this.hour))&&(empty(n)||includes(n,this.minute)))break}};DateTime.prototype.addSeconds=function(e,t,r,n,a){t&&(this.second+=Math.floor((86399-(this.hour*3600+this.minute*60+this.second))/e)*e);for(;;){this.second+=e;var i=divmod(this.second,60),o=i.div,s=i.mod;if(o){this.second=s;this.addMinutes(o,false,r,n)}if((empty(r)||includes(r,this.hour))&&(empty(n)||includes(n,this.minute))&&(empty(a)||includes(a,this.second)))break}};DateTime.prototype.fixDay=function(){if(!(this.day<=28)){var e=monthRange(this.year,this.month-1)[1];if(!(this.day<=e))while(this.day>e){this.day-=e;++this.month;if(this.month===13){this.month=1;++this.year;if(this.year>h)return}e=monthRange(this.year,this.month-1)[1]}}};DateTime.prototype.add=function(e,t){var r=e.freq,n=e.interval,a=e.wkst,i=e.byhour,o=e.byminute,s=e.bysecond;switch(r){case m.YEARLY:return this.addYears(n);case m.MONTHLY:return this.addMonths(n);case m.WEEKLY:return this.addWeekly(n,a);case m.DAILY:return this.addDaily(n);case m.HOURLY:return this.addHours(n,t,i);case m.MINUTELY:return this.addMinutes(n,t,i,o);case m.SECONDLY:return this.addSeconds(n,t,i,o,s)}};return DateTime}(w);function initializeOptions$1(e){var r=[];var n=Object.keys(e);for(var a=0,i=n;a<i.length;a++){var o=i[a];includes(K,o)||r.push(o);isDate(e[o])&&!isValidDate(e[o])&&r.push(o)}if(r.length)throw new Error("Invalid options: "+r.join(", "));return t({},e)}function parseOptions(e){var r=t(t({},P),initializeOptions$1(e));isPresent(r.byeaster)&&(r.freq=Z.YEARLY);if(!(isPresent(r.freq)&&Z.FREQUENCIES[r.freq]))throw new Error("Invalid frequency: ".concat(r.freq," ").concat(e.freq));r.dtstart||(r.dtstart=new Date((new Date).setMilliseconds(0)));isPresent(r.wkst)?isNumber(r.wkst)||(r.wkst=r.wkst.weekday):r.wkst=Z.MO.weekday;if(isPresent(r.bysetpos)){isNumber(r.bysetpos)&&(r.bysetpos=[r.bysetpos]);for(var n=0;n<r.bysetpos.length;n++){var a=r.bysetpos[n];if(a===0||!(a>=-366&&a<=366))throw new Error("bysetpos must be between 1 and 366, or between -366 and -1")}}if(!(Boolean(r.byweekno)||notEmpty(r.byweekno)||notEmpty(r.byyearday)||Boolean(r.bymonthday)||notEmpty(r.bymonthday)||isPresent(r.byweekday)||isPresent(r.byeaster)))switch(r.freq){case Z.YEARLY:r.bymonth||(r.bymonth=r.dtstart.getUTCMonth()+1);r.bymonthday=r.dtstart.getUTCDate();break;case Z.MONTHLY:r.bymonthday=r.dtstart.getUTCDate();break;case Z.WEEKLY:r.byweekday=[getWeekday(r.dtstart)];break}isPresent(r.bymonth)&&!o(r.bymonth)&&(r.bymonth=[r.bymonth]);isPresent(r.byyearday)&&!o(r.byyearday)&&isNumber(r.byyearday)&&(r.byyearday=[r.byyearday]);if(isPresent(r.bymonthday))if(o(r.bymonthday)){var s=[];var u=[];for(n=0;n<r.bymonthday.length;n++){a=r.bymonthday[n];a>0?s.push(a):a<0&&u.push(a)}r.bymonthday=s;r.bynmonthday=u}else if(r.bymonthday<0){r.bynmonthday=[r.bymonthday];r.bymonthday=[]}else{r.bynmonthday=[];r.bymonthday=[r.bymonthday]}else{r.bymonthday=[];r.bynmonthday=[]}isPresent(r.byweekno)&&!o(r.byweekno)&&(r.byweekno=[r.byweekno]);if(isPresent(r.byweekday))if(isNumber(r.byweekday)){r.byweekday=[r.byweekday];r.bynweekday=null}else if(isWeekdayStr(r.byweekday)){r.byweekday=[i.fromStr(r.byweekday).weekday];r.bynweekday=null}else if(r.byweekday instanceof i)if(!r.byweekday.n||r.freq>Z.MONTHLY){r.byweekday=[r.byweekday.weekday];r.bynweekday=null}else{r.bynweekday=[[r.byweekday.weekday,r.byweekday.n]];r.byweekday=null}else{var h=[];var l=[];for(n=0;n<r.byweekday.length;n++){var d=r.byweekday[n];isNumber(d)?h.push(d):isWeekdayStr(d)?h.push(i.fromStr(d).weekday):!d.n||r.freq>Z.MONTHLY?h.push(d.weekday):l.push([d.weekday,d.n])}r.byweekday=notEmpty(h)?h:null;r.bynweekday=notEmpty(l)?l:null}else r.bynweekday=null;isPresent(r.byhour)?isNumber(r.byhour)&&(r.byhour=[r.byhour]):r.byhour=r.freq<Z.HOURLY?[r.dtstart.getUTCHours()]:null;isPresent(r.byminute)?isNumber(r.byminute)&&(r.byminute=[r.byminute]):r.byminute=r.freq<Z.MINUTELY?[r.dtstart.getUTCMinutes()]:null;isPresent(r.bysecond)?isNumber(r.bysecond)&&(r.bysecond=[r.bysecond]):r.bysecond=r.freq<Z.SECONDLY?[r.dtstart.getUTCSeconds()]:null;return{parsedOptions:r}}function buildTimeset(e){var t=e.dtstart.getTime()%1e3;if(!freqIsDailyOrGreater(e.freq))return[];var r=[];e.byhour.forEach((function(n){e.byminute.forEach((function(a){e.bysecond.forEach((function(e){r.push(new w(n,a,e,t))}))}))}));return r}function parseString(e){var r=e.split("\n").map(parseLine).filter((function(e){return e!==null}));return t(t({},r[0]),r[1])}function parseDtstart(e){var t={};var r=/DTSTART(?:;TZID=([^:=]+?))?(?::|=)([^;\s]+)/i.exec(e);if(!r)return t;var n=r[1],a=r[2];n&&(t.tzid=n);t.dtstart=untilStringToDate(a);return t}function parseLine(e){e=e.replace(/^\s+|\s+$/,"");if(!e.length)return null;var t=/^([A-Z]+?)[:;]/.exec(e.toUpperCase());if(!t)return parseRrule(e);var r=t[1];switch(r.toUpperCase()){case"RRULE":case"EXRULE":return parseRrule(e);case"DTSTART":return parseDtstart(e);default:throw new Error("Unsupported RFC prop ".concat(r," in ").concat(e))}}function parseRrule(e){var t=e.replace(/^RRULE:/i,"");var r=parseDtstart(t);var n=e.replace(/^(?:RRULE|EXRULE):/i,"").split(";");n.forEach((function(t){var n=t.split("="),a=n[0],i=n[1];switch(a.toUpperCase()){case"FREQ":r.freq=m[i.toUpperCase()];break;case"WKST":r.wkst=z[i.toUpperCase()];break;case"COUNT":case"INTERVAL":case"BYSETPOS":case"BYMONTH":case"BYMONTHDAY":case"BYYEARDAY":case"BYWEEKNO":case"BYHOUR":case"BYMINUTE":case"BYSECOND":var o=parseNumber(i);var s=a.toLowerCase();r[s]=o;break;case"BYWEEKDAY":case"BYDAY":r.byweekday=parseWeekday(i);break;case"DTSTART":case"TZID":var u=parseDtstart(e);r.tzid=u.tzid;r.dtstart=u.dtstart;break;case"UNTIL":r.until=untilStringToDate(i);break;case"BYEASTER":r.byeaster=Number(i);break;default:throw new Error("Unknown RRULE property '"+a+"'")}}));return r}function parseNumber(e){if(e.indexOf(",")!==-1){var t=e.split(",");return t.map(parseIndividualNumber)}return parseIndividualNumber(e)}function parseIndividualNumber(e){return/^[+-]?\d+$/.test(e)?Number(e):e}function parseWeekday(e){var t=e.split(",");return t.map((function(e){if(e.length===2)return z[e];var t=e.match(/^([+-]?\d{1,2})([A-Z]{2})$/);if(!t||t.length<3)throw new SyntaxError("Invalid weekday string: ".concat(e));var r=Number(t[1]);var n=t[2];var a=z[n].weekday;return new i(a,r)}))}var g=function(){function DateWithZone(e,t){if(isNaN(e.getTime()))throw new RangeError("Invalid date passed to DateWithZone");this.date=e;this.tzid=t}Object.defineProperty(DateWithZone.prototype,"isUTC",{get:function(){return!this.tzid||this.tzid.toUpperCase()==="UTC"},enumerable:false,configurable:true});DateWithZone.prototype.toString=function(){var e=timeToUntilString(this.date.getTime(),this.isUTC);return this.isUTC?":".concat(e):";TZID=".concat(this.tzid,":").concat(e)};DateWithZone.prototype.getTime=function(){return this.date.getTime()};DateWithZone.prototype.rezonedDate=function(){return this.isUTC?this.date:dateInTimeZone(this.date,this.tzid)};return DateWithZone}();function optionsToString(e){var t=[];var r="";var n=Object.keys(e);var a=Object.keys(P);for(var s=0;s<n.length;s++)if(n[s]!=="tzid"&&includes(a,n[s])){var u=n[s].toUpperCase();var h=e[n[s]];var l="";if(isPresent(h)&&(!o(h)||h.length)){switch(u){case"FREQ":l=Z.FREQUENCIES[e.freq];break;case"WKST":l=isNumber(h)?new i(h).toString():h.toString();break;case"BYWEEKDAY":u="BYDAY";l=toArray(h).map((function(e){return e instanceof i?e:o(e)?new i(e[0],e[1]):new i(e)})).toString();break;case"DTSTART":r=buildDtstart(h,e.tzid);break;case"UNTIL":l=timeToUntilString(h,!e.tzid);break;default:if(o(h)){var d=[];for(var c=0;c<h.length;c++)d[c]=String(h[c]);l=d.toString()}else l=String(h)}l&&t.push([u,l])}}var y=t.map((function(e){var t=e[0],r=e[1];return"".concat(t,"=").concat(r.toString())})).join(";");var f="";y!==""&&(f="RRULE:".concat(y));return[r,f].filter((function(e){return!!e})).join("\n")}function buildDtstart(e,t){return e?"DTSTART"+new g(new Date(e),t).toString():""}function argsMatch(e,t){return Array.isArray(e)?!!Array.isArray(t)&&(e.length===t.length&&e.every((function(e,r){return e.getTime()===t[r].getTime()}))):e instanceof Date?t instanceof Date&&e.getTime()===t.getTime():e===t}var T=function(){function Cache(){this.all=false;this.before=[];this.after=[];this.between=[]}
/**
     * @param {String} what - all/before/after/between
     * @param {Array,Date} value - an array of dates, one date, or null
     * @param {Object?} args - _iter arguments
     */Cache.prototype._cacheAdd=function(e,t,r){t&&(t=t instanceof Date?clone(t):cloneDates(t));if(e==="all")this.all=t;else{r._value=t;this[e].push(r)}};Cache.prototype._cacheGet=function(e,t){var r=false;var n=t?Object.keys(t):[];var findCacheDiff=function(e){for(var r=0;r<n.length;r++){var a=n[r];if(!argsMatch(t[a],e[a]))return true}return false};var a=this[e];if(e==="all")r=this.all;else if(o(a))for(var i=0;i<a.length;i++){var s=a[i];if(!n.length||!findCacheDiff(s)){r=s._value;break}}if(!r&&this.all){var u=new c(e,t);for(i=0;i<this.all.length;i++)if(!u.accept(this.all[i]))break;r=u.getValue();this._cacheAdd(e,r,t)}return o(r)?cloneDates(r):r instanceof Date?clone(r):r};return Cache}();var R=r(r(r(r(r(r(r(r(r(r(r(r(r([],repeat(1,31),true),repeat(2,28),true),repeat(3,31),true),repeat(4,30),true),repeat(5,31),true),repeat(6,30),true),repeat(7,31),true),repeat(8,31),true),repeat(9,30),true),repeat(10,31),true),repeat(11,30),true),repeat(12,31),true),repeat(1,7),true);var E=r(r(r(r(r(r(r(r(r(r(r(r(r([],repeat(1,31),true),repeat(2,29),true),repeat(3,31),true),repeat(4,30),true),repeat(5,31),true),repeat(6,30),true),repeat(7,31),true),repeat(8,31),true),repeat(9,30),true),repeat(10,31),true),repeat(11,30),true),repeat(12,31),true),repeat(1,7),true);var D=range(1,29);var x=range(1,30);var O=range(1,31);var Y=range(1,32);var U=r(r(r(r(r(r(r(r(r(r(r(r(r([],Y,true),x,true),Y,true),O,true),Y,true),O,true),Y,true),Y,true),O,true),Y,true),O,true),Y,true),Y.slice(0,7),true);var I=r(r(r(r(r(r(r(r(r(r(r(r(r([],Y,true),D,true),Y,true),O,true),Y,true),O,true),Y,true),Y,true),O,true),Y,true),O,true),Y,true),Y.slice(0,7),true);var L=range(-28,0);var M=range(-29,0);var N=range(-30,0);var _=range(-31,0);var C=r(r(r(r(r(r(r(r(r(r(r(r(r([],_,true),M,true),_,true),N,true),_,true),N,true),_,true),_,true),N,true),_,true),N,true),_,true),_.slice(0,7),true);var A=r(r(r(r(r(r(r(r(r(r(r(r(r([],_,true),L,true),_,true),N,true),_,true),N,true),_,true),_,true),N,true),_,true),N,true),_,true),_.slice(0,7),true);var W=[0,31,60,91,121,152,182,213,244,274,305,335,366];var H=[0,31,59,90,120,151,181,212,243,273,304,334,365];var q=function(){var e=[];for(var t=0;t<55;t++)e=e.concat(range(7));return e}();function rebuildYear(e,r){var n=datetime(e,1,1);var a=isLeapYear(e)?366:365;var i=isLeapYear(e+1)?366:365;var o=toOrdinal(n);var s=getWeekday(n);var u=t(t({yearlen:a,nextyearlen:i,yearordinal:o,yearweekday:s},baseYearMasks(e)),{wnomask:null});if(empty(r.byweekno))return u;u.wnomask=repeat(0,a+7);var h;var l;var d=h=pymod(7-s+r.wkst,7);if(d>=4){d=0;l=u.yearlen+pymod(s-r.wkst,7)}else l=a-d;var c=Math.floor(l/7);var y=pymod(l,7);var f=Math.floor(c+y/4);for(var p=0;p<r.byweekno.length;p++){var m=r.byweekno[p];m<0&&(m+=f+1);if(m>0&&m<=f){var v=void 0;if(m>1){v=d+7*(m-1);d!==h&&(v-=7-h)}else v=d;for(var b=0;b<7;b++){u.wnomask[v]=1;v++;if(u.wdaymask[v]===r.wkst)break}}}if(includes(r.byweekno,1)){v=d+f*7;d!==h&&(v-=7-h);if(v<a)for(p=0;p<7;p++){u.wnomask[v]=1;v+=1;if(u.wdaymask[v]===r.wkst)break}}if(d){var w=void 0;if(includes(r.byweekno,-1))w=-1;else{var k=getWeekday(datetime(e-1,1,1));var g=pymod(7-k.valueOf()+r.wkst,7);var T=isLeapYear(e-1)?366:365;var R=void 0;if(g>=4){g=0;R=T+pymod(k-r.wkst,7)}else R=a-d;w=Math.floor(52+pymod(R,7)/4)}if(includes(r.byweekno,w))for(v=0;v<d;v++)u.wnomask[v]=1}return u}function baseYearMasks(e){var t=isLeapYear(e)?366:365;var r=datetime(e,1,1);var n=getWeekday(r);return t===365?{mmask:R,mdaymask:I,nmdaymask:A,wdaymask:q.slice(n),mrange:H}:{mmask:E,mdaymask:U,nmdaymask:C,wdaymask:q.slice(n),mrange:W}}function rebuildMonth(e,t,r,n,a,i){var o={lastyear:e,lastmonth:t,nwdaymask:[]};var s=[];if(i.freq===Z.YEARLY)if(empty(i.bymonth))s=[[0,r]];else for(var u=0;u<i.bymonth.length;u++){t=i.bymonth[u];s.push(n.slice(t-1,t+1))}else i.freq===Z.MONTHLY&&(s=[n.slice(t-1,t+1)]);if(empty(s))return o;o.nwdaymask=repeat(0,r);for(u=0;u<s.length;u++){var h=s[u];var l=h[0];var d=h[1]-1;for(var c=0;c<i.bynweekday.length;c++){var y=void 0;var f=i.bynweekday[c],p=f[0],m=f[1];if(m<0){y=d+(m+1)*7;y-=pymod(a[y]-p,7)}else{y=l+7*(m-1);y+=pymod(7-a[y]+p,7)}l<=y&&y<=d&&(o.nwdaymask[y]=1)}}return o}function easter(e,t){t===void 0&&(t=0);var r=e%19;var n=Math.floor(e/100);var a=e%100;var i=Math.floor(n/4);var o=n%4;var s=Math.floor((n+8)/25);var u=Math.floor((n-s+1)/3);var h=Math.floor(19*r+n-i-u+15)%30;var l=Math.floor(a/4);var d=a%4;var c=Math.floor(32+2*o+2*l-h-d)%7;var y=Math.floor((r+11*h+22*c)/451);var f=Math.floor((h+c-7*y+114)/31);var p=(h+c-7*y+114)%31+1;var m=Date.UTC(e,f-1,p+t);var v=Date.UTC(e,0,1);return[Math.ceil((m-v)/864e5)]}var j=function(){function Iterinfo(e){this.options=e}Iterinfo.prototype.rebuild=function(e,t){var r=this.options;e!==this.lastyear&&(this.yearinfo=rebuildYear(e,r));if(notEmpty(r.bynweekday)&&(t!==this.lastmonth||e!==this.lastyear)){var n=this.yearinfo,a=n.yearlen,i=n.mrange,o=n.wdaymask;this.monthinfo=rebuildMonth(e,t,a,i,o,r)}isPresent(r.byeaster)&&(this.eastermask=easter(e,r.byeaster))};Object.defineProperty(Iterinfo.prototype,"lastyear",{get:function(){return this.monthinfo?this.monthinfo.lastyear:null},enumerable:false,configurable:true});Object.defineProperty(Iterinfo.prototype,"lastmonth",{get:function(){return this.monthinfo?this.monthinfo.lastmonth:null},enumerable:false,configurable:true});Object.defineProperty(Iterinfo.prototype,"yearlen",{get:function(){return this.yearinfo.yearlen},enumerable:false,configurable:true});Object.defineProperty(Iterinfo.prototype,"yearordinal",{get:function(){return this.yearinfo.yearordinal},enumerable:false,configurable:true});Object.defineProperty(Iterinfo.prototype,"mrange",{get:function(){return this.yearinfo.mrange},enumerable:false,configurable:true});Object.defineProperty(Iterinfo.prototype,"wdaymask",{get:function(){return this.yearinfo.wdaymask},enumerable:false,configurable:true});Object.defineProperty(Iterinfo.prototype,"mmask",{get:function(){return this.yearinfo.mmask},enumerable:false,configurable:true});Object.defineProperty(Iterinfo.prototype,"wnomask",{get:function(){return this.yearinfo.wnomask},enumerable:false,configurable:true});Object.defineProperty(Iterinfo.prototype,"nwdaymask",{get:function(){return this.monthinfo?this.monthinfo.nwdaymask:[]},enumerable:false,configurable:true});Object.defineProperty(Iterinfo.prototype,"nextyearlen",{get:function(){return this.yearinfo.nextyearlen},enumerable:false,configurable:true});Object.defineProperty(Iterinfo.prototype,"mdaymask",{get:function(){return this.yearinfo.mdaymask},enumerable:false,configurable:true});Object.defineProperty(Iterinfo.prototype,"nmdaymask",{get:function(){return this.yearinfo.nmdaymask},enumerable:false,configurable:true});Iterinfo.prototype.ydayset=function(){return[range(this.yearlen),0,this.yearlen]};Iterinfo.prototype.mdayset=function(e,t){var r=this.mrange[t-1];var n=this.mrange[t];var a=repeat(null,this.yearlen);for(var i=r;i<n;i++)a[i]=i;return[a,r,n]};Iterinfo.prototype.wdayset=function(e,t,r){var n=repeat(null,this.yearlen+7);var a=toOrdinal(datetime(e,t,r))-this.yearordinal;var i=a;for(var o=0;o<7;o++){n[a]=a;++a;if(this.wdaymask[a]===this.options.wkst)break}return[n,i,a]};Iterinfo.prototype.ddayset=function(e,t,r){var n=repeat(null,this.yearlen);var a=toOrdinal(datetime(e,t,r))-this.yearordinal;n[a]=a;return[n,a,a+1]};Iterinfo.prototype.htimeset=function(e,t,r,n){var a=this;var i=[];this.options.byminute.forEach((function(t){i=i.concat(a.mtimeset(e,t,r,n))}));sort(i);return i};Iterinfo.prototype.mtimeset=function(e,t,r,n){var a=this.options.bysecond.map((function(r){return new w(e,t,r,n)}));sort(a);return a};Iterinfo.prototype.stimeset=function(e,t,r,n){return[new w(e,t,r,n)]};Iterinfo.prototype.getdayset=function(e){switch(e){case m.YEARLY:return this.ydayset.bind(this);case m.MONTHLY:return this.mdayset.bind(this);case m.WEEKLY:return this.wdayset.bind(this);case m.DAILY:return this.ddayset.bind(this);default:return this.ddayset.bind(this)}};Iterinfo.prototype.gettimeset=function(e){switch(e){case m.HOURLY:return this.htimeset.bind(this);case m.MINUTELY:return this.mtimeset.bind(this);case m.SECONDLY:return this.stimeset.bind(this)}};return Iterinfo}();function buildPoslist(e,t,r,n,a,i){var o=[];for(var s=0;s<e.length;s++){var u=void 0;var h=void 0;var l=e[s];if(l<0){u=Math.floor(l/t.length);h=pymod(l,t.length)}else{u=Math.floor((l-1)/t.length);h=pymod(l-1,t.length)}var d=[];for(var c=r;c<n;c++){var y=i[c];isPresent(y)&&d.push(y)}var f=void 0;f=u<0?d.slice(u)[0]:d[u];var p=t[h];var m=fromOrdinal(a.yearordinal+f);var v=combine(m,p);includes(o,v)||o.push(v)}sort(o);return o}function iter(e,t){var r=t.dtstart,n=t.freq,a=t.interval,i=t.until,o=t.bysetpos;var s=t.count;if(s===0||a===0)return emitResult(e);var u=k.fromDate(r);var l=new j(t);l.rebuild(u.year,u.month);var d=makeTimeset(l,u,t);for(;;){var c=l.getdayset(n)(u.year,u.month,u.day),y=c[0],f=c[1],p=c[2];var m=removeFilteredDays(y,f,p,l,t);if(notEmpty(o)){var v=buildPoslist(o,d,f,p,l,y);for(var b=0;b<v.length;b++){var w=v[b];if(i&&w>i)return emitResult(e);if(w>=r){var g=rezoneIfNeeded(w,t);if(!e.accept(g))return emitResult(e);if(s){--s;if(!s)return emitResult(e)}}}}else for(b=f;b<p;b++){var T=y[b];if(isPresent(T)){var R=fromOrdinal(l.yearordinal+T);for(var E=0;E<d.length;E++){var D=d[E];w=combine(R,D);if(i&&w>i)return emitResult(e);if(w>=r){g=rezoneIfNeeded(w,t);if(!e.accept(g))return emitResult(e);if(s){--s;if(!s)return emitResult(e)}}}}}if(t.interval===0)return emitResult(e);u.add(t,m);if(u.year>h)return emitResult(e);freqIsDailyOrGreater(n)||(d=l.gettimeset(n)(u.hour,u.minute,u.second,0));l.rebuild(u.year,u.month)}}function isFiltered(e,t,r){var n=r.bymonth,a=r.byweekno,i=r.byweekday,o=r.byeaster,s=r.bymonthday,u=r.bynmonthday,h=r.byyearday;return notEmpty(n)&&!includes(n,e.mmask[t])||notEmpty(a)&&!e.wnomask[t]||notEmpty(i)&&!includes(i,e.wdaymask[t])||notEmpty(e.nwdaymask)&&!e.nwdaymask[t]||o!==null&&!includes(e.eastermask,t)||(notEmpty(s)||notEmpty(u))&&!includes(s,e.mdaymask[t])&&!includes(u,e.nmdaymask[t])||notEmpty(h)&&(t<e.yearlen&&!includes(h,t+1)&&!includes(h,-e.yearlen+t)||t>=e.yearlen&&!includes(h,t+1-e.yearlen)&&!includes(h,-e.nextyearlen+t-e.yearlen))}function rezoneIfNeeded(e,t){return new g(e,t.tzid).rezonedDate()}function emitResult(e){return e.getValue()}function removeFilteredDays(e,t,r,n,a){var i=false;for(var o=t;o<r;o++){var s=e[o];i=isFiltered(n,s,a);i&&(e[s]=null)}return i}function makeTimeset(e,t,r){var n=r.freq,a=r.byhour,i=r.byminute,o=r.bysecond;return freqIsDailyOrGreater(n)?buildTimeset(r):n>=Z.HOURLY&&notEmpty(a)&&!includes(a,t.hour)||n>=Z.MINUTELY&&notEmpty(i)&&!includes(i,t.minute)||n>=Z.SECONDLY&&notEmpty(o)&&!includes(o,t.second)?[]:e.gettimeset(n)(t.hour,t.minute,t.second,t.millisecond)}var z={MO:new i(0),TU:new i(1),WE:new i(2),TH:new i(3),FR:new i(4),SA:new i(5),SU:new i(6)};var P={freq:m.YEARLY,dtstart:null,interval:1,wkst:z.MO,count:null,until:null,tzid:null,bysetpos:null,bymonth:null,bymonthday:null,bynmonthday:null,byyearday:null,byweekno:null,byweekday:null,bynweekday:null,byhour:null,byminute:null,bysecond:null,byeaster:null};var K=Object.keys(P);
/**
 *
 * @param {Options?} options - see <http://labix.org/python-dateutil/#head-cf004ee9a75592797e076752b2a889c10f445418>
 * - The only required option is `freq`, one of RRule.YEARLY, RRule.MONTHLY, ...
 * @constructor
 */var Z=function(){function RRule(e,t){e===void 0&&(e={});t===void 0&&(t=false);this._cache=t?null:new T;this.origOptions=initializeOptions$1(e);var r=parseOptions(e).parsedOptions;this.options=r}RRule.parseText=function(e,t){return parseText(e,t)};RRule.fromText=function(e,t){return fromText(e,t)};RRule.fromString=function(e){return new RRule(RRule.parseString(e)||void 0)};RRule.prototype._iter=function(e){return iter(e,this.options)};RRule.prototype._cacheGet=function(e,t){return!!this._cache&&this._cache._cacheGet(e,t)};RRule.prototype._cacheAdd=function(e,t,r){if(this._cache)return this._cache._cacheAdd(e,t,r)};
/**
     * @param {Function} iterator - optional function that will be called
     * on each date that is added. It can return false
     * to stop the iteration.
     * @return Array containing all recurrences.
     */RRule.prototype.all=function(e){if(e)return this._iter(new y("all",{},e));var t=this._cacheGet("all");if(t===false){t=this._iter(new c("all",{}));this._cacheAdd("all",t)}return t};RRule.prototype.between=function(e,t,r,n){r===void 0&&(r=false);if(!isValidDate(e)||!isValidDate(t))throw new Error("Invalid date passed in to RRule.between");var a={before:t,after:e,inc:r};if(n)return this._iter(new y("between",a,n));var i=this._cacheGet("between",a);if(i===false){i=this._iter(new c("between",a));this._cacheAdd("between",i,a)}return i};RRule.prototype.before=function(e,t){t===void 0&&(t=false);if(!isValidDate(e))throw new Error("Invalid date passed in to RRule.before");var r={dt:e,inc:t};var n=this._cacheGet("before",r);if(n===false){n=this._iter(new c("before",r));this._cacheAdd("before",n,r)}return n};RRule.prototype.after=function(e,t){t===void 0&&(t=false);if(!isValidDate(e))throw new Error("Invalid date passed in to RRule.after");var r={dt:e,inc:t};var n=this._cacheGet("after",r);if(n===false){n=this._iter(new c("after",r));this._cacheAdd("after",n,r)}return n};RRule.prototype.count=function(){return this.all().length};RRule.prototype.toString=function(){return optionsToString(this.origOptions)};RRule.prototype.toText=function(e,t,r){return toText(this,e,t,r)};RRule.prototype.isFullyConvertibleToText=function(){return b(this)};RRule.prototype.clone=function(){return new RRule(this.origOptions)};RRule.FREQUENCIES=["YEARLY","MONTHLY","WEEKLY","DAILY","HOURLY","MINUTELY","SECONDLY"];RRule.YEARLY=m.YEARLY;RRule.MONTHLY=m.MONTHLY;RRule.WEEKLY=m.WEEKLY;RRule.DAILY=m.DAILY;RRule.HOURLY=m.HOURLY;RRule.MINUTELY=m.MINUTELY;RRule.SECONDLY=m.SECONDLY;RRule.MO=z.MO;RRule.TU=z.TU;RRule.WE=z.WE;RRule.TH=z.TH;RRule.FR=z.FR;RRule.SA=z.SA;RRule.SU=z.SU;RRule.parseString=parseString;RRule.optionsToString=optionsToString;return RRule}();function iterSet(e,t,r,n,a,i){var o={};var s=e.accept;function evalExdate(e,t){r.forEach((function(r){r.between(e,t,true).forEach((function(e){o[Number(e)]=true}))}))}a.forEach((function(e){var t=new g(e,i).rezonedDate();o[Number(t)]=true}));e.accept=function(e){var t=Number(e);if(isNaN(t))return s.call(this,e);if(!o[t]){evalExdate(new Date(t-1),new Date(t+1));if(!o[t]){o[t]=true;return s.call(this,e)}}return true};if(e.method==="between"){evalExdate(e.args.after,e.args.before);e.accept=function(e){var t=Number(e);if(!o[t]){o[t]=true;return s.call(this,e)}return true}}for(var u=0;u<n.length;u++){var h=new g(n[u],i).rezonedDate();if(!e.accept(new Date(h.getTime())))break}t.forEach((function(t){iter(e,t.options)}));var l=e._result;sort(l);switch(e.method){case"all":case"between":return l;case"before":return l.length&&l[l.length-1]||null;case"after":default:return l.length&&l[0]||null}}var B={dtstart:null,cache:false,unfold:false,forceset:false,compatible:false,tzid:null};function parseInput(e,t){var r=[];var n=[];var a=[];var i=[];var o=parseDtstart(e);var s=o.dtstart;var u=o.tzid;var h=splitIntoLines(e,t.unfold);h.forEach((function(e){var t;if(e){var o=breakDownLine(e),s=o.name,h=o.parms,l=o.value;switch(s.toUpperCase()){case"RRULE":if(h.length)throw new Error("unsupported RRULE parm: ".concat(h.join(",")));r.push(parseString(e));break;case"RDATE":var d=(t=/RDATE(?:;TZID=([^:=]+))?/i.exec(e))!==null&&t!==void 0?t:[],c=d[1];c&&!u&&(u=c);n=n.concat(parseRDate(l,h));break;case"EXRULE":if(h.length)throw new Error("unsupported EXRULE parm: ".concat(h.join(",")));a.push(parseString(l));break;case"EXDATE":i=i.concat(parseRDate(l,h));break;case"DTSTART":break;default:throw new Error("unsupported property: "+s)}}}));return{dtstart:s,tzid:u,rrulevals:r,rdatevals:n,exrulevals:a,exdatevals:i}}function buildRule(e,t){var r=parseInput(e,t),n=r.rrulevals,a=r.rdatevals,i=r.exrulevals,o=r.exdatevals,s=r.dtstart,u=r.tzid;var h=t.cache===false;if(t.compatible){t.forceset=true;t.unfold=true}if(t.forceset||n.length>1||a.length||i.length||o.length){var l=new G(h);l.dtstart(s);l.tzid(u||void 0);n.forEach((function(e){l.rrule(new Z(groomRruleOptions(e,s,u),h))}));a.forEach((function(e){l.rdate(e)}));i.forEach((function(e){l.exrule(new Z(groomRruleOptions(e,s,u),h))}));o.forEach((function(e){l.exdate(e)}));t.compatible&&t.dtstart&&l.rdate(s);return l}var d=n[0]||{};return new Z(groomRruleOptions(d,d.dtstart||t.dtstart||s,d.tzid||t.tzid||u),h)}function rrulestr(e,t){t===void 0&&(t={});return buildRule(e,initializeOptions(t))}function groomRruleOptions(e,r,n){return t(t({},e),{dtstart:r,tzid:n})}function initializeOptions(e){var r=[];var n=Object.keys(e);var a=Object.keys(B);n.forEach((function(e){includes(a,e)||r.push(e)}));if(r.length)throw new Error("Invalid options: "+r.join(", "));return t(t({},B),e)}function extractName(e){if(e.indexOf(":")===-1)return{name:"RRULE",value:e};var t=split(e,":",1),r=t[0],n=t[1];return{name:r,value:n}}function breakDownLine(e){var t=extractName(e),r=t.name,n=t.value;var a=r.split(";");if(!a)throw new Error("empty property name");return{name:a[0].toUpperCase(),parms:a.slice(1),value:n}}function splitIntoLines(e,t){t===void 0&&(t=false);e=e&&e.trim();if(!e)throw new Error("Invalid empty string");if(!t)return e.split(/\s/);var r=e.split("\n");var n=0;while(n<r.length){var a=r[n]=r[n].replace(/\s+$/g,"");if(a)if(n>0&&a[0]===" "){r[n-1]+=a.slice(1);r.splice(n,1)}else n+=1;else r.splice(n,1)}return r}function validateDateParm(e){e.forEach((function(e){if(!/(VALUE=DATE(-TIME)?)|(TZID=)/.test(e))throw new Error("unsupported RDATE/EXDATE parm: "+e)}))}function parseRDate(e,t){validateDateParm(t);return e.split(",").map((function(e){return untilStringToDate(e)}))}function createGetterSetter(e){var t=this;return function(r){r!==void 0&&(t["_".concat(e)]=r);if(t["_".concat(e)]!==void 0)return t["_".concat(e)];for(var n=0;n<t._rrule.length;n++){var a=t._rrule[n].origOptions[e];if(a)return a}}}var G=function(t){e(RRuleSet,t);
/**
     *
     * @param {Boolean?} noCache
     * The same stratagy as RRule on cache, default to false
     * @constructor
     */function RRuleSet(e){e===void 0&&(e=false);var r=t.call(this,{},e)||this;r.dtstart=createGetterSetter.apply(r,["dtstart"]);r.tzid=createGetterSetter.apply(r,["tzid"]);r._rrule=[];r._rdate=[];r._exrule=[];r._exdate=[];return r}RRuleSet.prototype._iter=function(e){return iterSet(e,this._rrule,this._exrule,this._rdate,this._exdate,this.tzid())};
/**
     * Adds an RRule to the set
     *
     * @param {RRule}
     */RRuleSet.prototype.rrule=function(e){_addRule(e,this._rrule)};
/**
     * Adds an EXRULE to the set
     *
     * @param {RRule}
     */RRuleSet.prototype.exrule=function(e){_addRule(e,this._exrule)};
/**
     * Adds an RDate to the set
     *
     * @param {Date}
     */RRuleSet.prototype.rdate=function(e){_addDate(e,this._rdate)};
/**
     * Adds an EXDATE to the set
     *
     * @param {Date}
     */RRuleSet.prototype.exdate=function(e){_addDate(e,this._exdate)};RRuleSet.prototype.rrules=function(){return this._rrule.map((function(e){return rrulestr(e.toString())}))};RRuleSet.prototype.exrules=function(){return this._exrule.map((function(e){return rrulestr(e.toString())}))};RRuleSet.prototype.rdates=function(){return this._rdate.map((function(e){return new Date(e.getTime())}))};RRuleSet.prototype.exdates=function(){return this._exdate.map((function(e){return new Date(e.getTime())}))};RRuleSet.prototype.valueOf=function(){var e=[];!this._rrule.length&&this._dtstart&&(e=e.concat(optionsToString({dtstart:this._dtstart})));this._rrule.forEach((function(t){e=e.concat(t.toString().split("\n"))}));this._exrule.forEach((function(t){e=e.concat(t.toString().split("\n").map((function(e){return e.replace(/^RRULE:/,"EXRULE:")})).filter((function(e){return!/^DTSTART/.test(e)})))}));this._rdate.length&&e.push(rdatesToString("RDATE",this._rdate,this.tzid()));this._exdate.length&&e.push(rdatesToString("EXDATE",this._exdate,this.tzid()));return e};RRuleSet.prototype.toString=function(){return this.valueOf().join("\n")};RRuleSet.prototype.clone=function(){var e=new RRuleSet(!!this._cache);this._rrule.forEach((function(t){return e.rrule(t.clone())}));this._exrule.forEach((function(t){return e.exrule(t.clone())}));this._rdate.forEach((function(t){return e.rdate(new Date(t.getTime()))}));this._exdate.forEach((function(t){return e.exdate(new Date(t.getTime()))}));return e};return RRuleSet}(Z);function _addRule(e,t){if(!(e instanceof Z))throw new TypeError(String(e)+" is not RRule instance");includes(t.map(String),String(e))||t.push(e)}function _addDate(e,t){if(!(e instanceof Date))throw new TypeError(String(e)+" is not Date instance");if(!includes(t.map(Number),Number(e))){t.push(e);sort(t)}}function rdatesToString(e,t,r){var n=!r||r.toUpperCase()==="UTC";var a=n?"".concat(e,":"):"".concat(e,";TZID=").concat(r,":");var i=t.map((function(e){return timeToUntilString(e.valueOf(),n)})).join(",");return"".concat(a).concat(i)}export{a as ALL_WEEKDAYS,m as Frequency,Z as RRule,G as RRuleSet,i as Weekday,datetime,rrulestr};

